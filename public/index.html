<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Habit Tracker API</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="container">
      <h1>üå± Habit Tracker API</h1>
      <p class="subtitle">Backend API for tracking daily and weekly habits using Node.js & MongoDB</p>
    </div>
  </header>

  <main class="container">

    <!-- Display all habits -->
    <section>
      <h2>–í—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏</h2>
      <ul id="habit-list"></ul>
    </section>

    <!-- Filter / Sort / Projection -->
    <section>
      <h2>–§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h2>
      <button onclick="loadHabitsFiltered('daily')">–¢–æ–ª—å–∫–æ daily</button>
      <button onclick="loadHabitsFiltered('weekly')">–¢–æ–ª—å–∫–æ weekly</button>
      <button onclick="loadHabitsSorted('createdAt','desc')">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ (DESC)</button>
      <button onclick="loadHabitsProjection('title,frequency')">–¢–æ–ª—å–∫–æ title –∏ frequency</button>
      <button onclick="loadHabits()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
    </section>

    <!-- Create Habit -->
    <section>
      <h2>‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h2>
      <input id="create-title" placeholder="Title" />
      <input id="create-frequency" placeholder="daily / weekly" />
      <button onclick="createHabit()">–°–æ–∑–¥–∞—Ç—å</button>
      <pre id="create-result"></pre>
    </section>

    <!-- Update Habit -->
    <section>
      <h2>‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h2>
      <input id="update-id" placeholder="Habit ID" />
      <input id="update-title" placeholder="–ù–æ–≤—ã–π title" />
      <input id="update-frequency" placeholder="daily / weekly" />
      <button onclick="updateHabit()">–û–±–Ω–æ–≤–∏—Ç—å</button>
      <pre id="update-result"></pre>
    </section>

    <!-- Delete Habit -->
    <section>
      <h2>üóë –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h2>
      <input id="delete-id" placeholder="Habit ID" />
      <button onclick="deleteHabit()">–£–¥–∞–ª–∏—Ç—å</button>
      <pre id="delete-result"></pre>
    </section>

  </main>

  <script>
    // Load all habits
    async function loadHabits() {
      const res = await fetch('/api/habits');
      const habits = await res.json();
      renderHabits(habits);
    }

    // Load filtered habits
    async function loadHabitsFiltered(frequency) {
      const res = await fetch(`/api/habits?frequency=${frequency}`);
      const habits = await res.json();
      renderHabits(habits);
    }

    // Load sorted habits
    async function loadHabitsSorted(field, order) {
      const res = await fetch(`/api/habits?sortBy=${field}&order=${order}`);
      const habits = await res.json();
      renderHabits(habits);
    }

    // Load projected habits
    async function loadHabitsProjection(fields) {
      const res = await fetch(`/api/habits?fields=${fields}`);
      const habits = await res.json();
      renderHabits(habits);
    }

    // Render habits list
    function renderHabits(habits) {
      const list = document.getElementById('habit-list');
      list.innerHTML = '';
      habits.forEach(habit => {
        const li = document.createElement('li');
        li.textContent = `${habit.title} ‚Äî ${habit.frequency} (ID: ${habit._id})`;
        list.appendChild(li);
      });
    }

    // Create habit
    async function createHabit() {
      const title = document.getElementById('create-title').value;
      const frequency = document.getElementById('create-frequency').value;

      const res = await fetch('/api/habits', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, frequency })
      });
      const data = await res.json();
      document.getElementById('create-result').textContent =
        `Status: ${res.status}\n` + JSON.stringify(data, null, 2);
      loadHabits();
    }

    // Update habit
    async function updateHabit() {
      const id = document.getElementById('update-id').value;
      const title = document.getElementById('update-title').value;
      const frequency = document.getElementById('update-frequency').value;

      const res = await fetch(`/api/habits/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, frequency })
      });
      const data = await res.json();
      document.getElementById('update-result').textContent =
        `Status: ${res.status}\n` + JSON.stringify(data, null, 2);
      loadHabits();
    }

    // Delete habit
    async function deleteHabit() {
      const id = document.getElementById('delete-id').value;

      const res = await fetch(`/api/habits/${id}`, {
        method: 'DELETE'
      });
      const data = await res.json();
      document.getElementById('delete-result').textContent =
        `Status: ${res.status}\n` + JSON.stringify(data, null, 2);
      loadHabits();
    }

    // Initial load
    loadHabits();
  </script>
</body>
</html>
